<!DOCTYPE html>
<html lang="en">

<head th:replace="common/head"></head>

<body>

  <div th:replace="common/header"></div>
  <nav th:replace="common/nav"></nav>

  <div class="container mt-5">
    <div class="card">
      <div class="card-body">
        <span class="badge bg-primary rounded-pill" th:text="${qna.id} + 'ë²ˆ'"></span>
        <h5 class="card-title" th:text="${qna.title}"></h5>
        <h6 class="card-subtitle mb-2 text-muted" th:text="${qna.userId}"></h6>
        <p class="card-text" th:text="${qna.content}"></p>
        <form action="/qna/comment" method="post">
          <input type="text" name="content">
          <input type="hidden" name="qnaId" th:value="${qna.id}">
          <button type="submit">ëŒ“ê¸€ğŸ˜Šë‹¬ê¸°</button>
        </form>
        <hr>
        ëŒ“ê¸€âœï¸
        <ul th:each="comment : ${qna.comments}">
          <li>
            [[ ${comment.content} ]] / [[ ${comment.writer} ]] / [[${#dates.format(comment.creDate, 'yyyy-MM-dd
            HH:mm:ss')}]]
            <!-- ëŒ“ê¸€ ì‚­ì œ ë²„íŠ¼ -->
            <button
              th:if="${session.user_info != null && session.user_info.email == qna.userId || session.user_info.name ==comment.writer }"
              th:onclick="'commentRm(' + ${comment.id} +')'">ëŒ“ì‚­ğŸ¥²</button>
          </li>
        </ul>
        <hr>
        ì²¨ë¶€ëœ íŒŒì¼ğŸ“¥
        <!-- ì²¨ë¶€ëœ íŒŒì¼ ëª©ë¡ -->
        <ul th:each="fileAtch : ${qna.fileAtchs}">
          <li style="list-style-type: none;">
            <a th:href="@{/download(id=${fileAtch.id})}">
              [[${fileAtch.originalName}]]
            </a>
            <!-- íŒŒì¼ ì‚­ì œ ë²„íŠ¼ -->
            <button th:if="${session.user_info != null && session.user_info.email == qna.userId && && fileAtch != null}"
              th:onclick="'fileRm(' + ${fileAtch.id} +')'">íŒŒì¼ì‚­ì œâœ‚ï¸</button>
          </li>
        </ul>

      </div>
    </div>
  </div>
  <div class="container mt-5">
    <ul class="nav justify-content-end">
      <li class="nav-item">
        <a class="nav-link" th:href="@{/qna/list}" id="list">ëª©ë¡</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#" th:href="@{'/qna/update/' + ${qna.id}}" id="update">ìˆ˜ì •</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#" th:data-num="${qna.id}" id="delete">ì‚­ì œ</a>
      </li>
    </ul>
  </div>

  <!-- <div th:replace="common/footer">
  </div> -->

  <script>
    var authorUserId = "[[${qna.userId}]]";

    document.querySelector('#update').addEventListener('click', (e) => {
      e.preventDefault();
      // ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      var currentUser = "[[${session.user_info != null ? session.user_info.email : ''}]]"; // null ì²´í¬ ì¶”ê°€
      if (currentUser !== authorUserId) {
        alert('ê²Œì‹œê¸€ ì‘ì„±ìë§Œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'); // ìˆ˜ì • ê¶Œí•œì´ ì—†ì„ ë•Œ ê²½ê³ ì°½ í‘œì‹œ
      } else {
        // ìˆ˜ì • í˜ì´ì§€ë¡œ ì´ë™
        window.location.href = e.target.getAttribute("href");
      }
    });

    document.querySelector('#delete').addEventListener('click', (e) => {
      e.preventDefault();
      if (confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        const num = e.target.dataset.num;
        if (num !== "null")
          location = `/qna/delete/${num}`;
      }
    });

    function commentRm(id) {
      const isOk = confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
      if (isOk) {
        location = `/qna/comment/remove?id=${id}&qnaId=[[${qna.id}]]`;
      }
    }

    function fileRm(id) {
      const isOk = confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
      if (isOk) {
        location = `/qna/fileAtch/remove?id=${id}&qnaId=[[${qna.id}]]`;
      }
    }
  </script>
</body>

</html>
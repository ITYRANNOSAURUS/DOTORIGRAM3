<!DOCTYPE html>
<html lang="en">

<head th:replace="common/head"></head>

<style>
  @font-face {
    font-family: 'TheJamsil5Bold';
    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2302_01@1.0/TheJamsil5Bold.woff2') format('woff2');
    font-weight: 500;
    font-style: normal;
  }

  body {
    font-family: 'TheJamsil5Bold';
    height: 100vh;
    /* í™”ë©´ ë†’ì´ì˜ 100%ë¡œ ì„¤ì • */
    background-color: #000;
    background-size: cover;
    /* ì´ë¯¸ì§€ë¥¼ í™”ë©´ì— ë§ê²Œ ì¡°ì ˆ */
    background-repeat: no-repeat;
    /* ì´ë¯¸ì§€ ë°˜ë³µì„ ì¤‘ì§€ */
  }
</style>

<body>

  <div th:replace="common/header"></div>
  <nav th:replace="common/nav"></nav>

  <div class="container mt-5">
    <div class="card">
      <div class="card-body">
        <span class="badge bg-primary rounded-pill" th:text="${board.id} + 'ë²ˆ'"></span>
        <h5 class="card-title" th:text="${board.title}"></h5>
        <h6 class="card-subtitle mb-2 text-muted" th:text="${board.user.email}"></h6>
        <p class="card-text" th:text="${board.content}"></p>

        <div id="imageContainer">
          <img th:each="fileAtch : ${board.fileAtchs}" th:src="@{/download(id=${fileAtch.id})}" alt="ì²¨ë¶€ëœ ì´ë¯¸ì§€">
        </div>

        <form action="/board/comment" method="post">
          <input type="text" name="content">
          <input type="hidden" name="boardId" th:value="${board.id}">
          <button type="submit">ëŒ“ê¸€ğŸ˜Šë‹¬ê¸°</button>
        </form>
        <hr>
        ëŒ“ê¸€âœï¸
        <ul th:each="comment : ${board.comments}">
          <li>
            [[ ${comment.content} ]] / [[ ${comment.writer} ]] / [[${#dates.format(comment.creDate, 'yyyy-MM-dd
            HH:mm:ss')}]]
            <!-- ëŒ“ê¸€ ì‚­ì œ ë²„íŠ¼ -->
            <button
              th:if="${session.user_info != null && session.user_info.email == board.user.email || session.user_info.name ==comment.writer }"
              th:onclick="'commentRm(' + ${comment.id} +')'">ëŒ“ì‚­ğŸ¥²</button>
          </li>
        </ul>
        <hr>
        ì²¨ë¶€ëœ íŒŒì¼ğŸ“¥
        <!-- ì²¨ë¶€ëœ íŒŒì¼ ëª©ë¡ -->
        <ul th:each="fileAtch : ${board.fileAtchs}">

          <li style="list-style-type: none;">
            <a th:href="@{/download(id=${fileAtch.id})}">
              [[${fileAtch.originalName}]]
            </a>
            <!-- íŒŒì¼ ì‚­ì œ ë²„íŠ¼ -->
            <button th:if="${session.user_info != null && session.user_info.email == board.user.email}"
              th:style="${fileAtch.originalName == '' ? 'display:none;' : ''}"
              th:onclick="'fileRm(' + ${fileAtch.id} +')'">íŒŒì¼ì‚­ì œâœ‚ï¸
            </button>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div class="container mt-5">
    <ul class="nav justify-content-end">
      <li class="nav-item">
        <a class="nav-link" th:href="@{/board/list}" id="list">ëª©ë¡</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" th:href="@{'/board/update/' + ${board.id}}" id="update">ìˆ˜ì •</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" th:data-num="${board.id}" id="delete">ì‚­ì œ</a>
      </li>
    </ul>
  </div>


  <script>

    // íŒŒì¼ ì—…ë¡œë“œ input ìš”ì†Œì˜ change ì´ë²¤íŠ¸ë¥¼ ê°ì§€í•˜ì—¬ ì´ë¯¸ì§€ë¥¼ í‘œì‹œ
    document.getElementById("fileInput").addEventListener("change", function (event) {
      var files = event.target.files; // ì„ íƒëœ íŒŒì¼ë“¤

      // ì´ë¯¸ì§€ë¥¼ í‘œì‹œí•  ì˜ì—­ì˜ DOM ìš”ì†Œ
      var imageContainer = document.getElementById("imageContainer");

      // ì„ íƒëœ íŒŒì¼ë“¤ì„ ìˆœíšŒí•˜ë©´ì„œ ì´ë¯¸ì§€ë¥¼ í‘œì‹œ
      for (var i = 0; i < files.length; i++) {
        var file = files[i];
        var imageURL = URL.createObjectURL(file); // íŒŒì¼ URL ìƒì„±

        // ì´ë¯¸ì§€ë¥¼ í‘œì‹œí•˜ëŠ” <img> ìš”ì†Œ ìƒì„± ë° ì„¤ì •
        var imageElement = document.createElement("img");
        imageElement.src = imageURL;

        // ì´ë¯¸ì§€ë¥¼ í‘œì‹œí•  ì˜ì—­ì— ì¶”ê°€
        imageContainer.appendChild(imageElement);
      }
    });

    var authorUserId = "[[${board.user.email}]]";

    document.querySelector('#update').addEventListener('click', (e) => {
      e.preventDefault();
      // ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      var currentUser = "[[${session.user_info != null ? session.user_info.email : ''}]]"; // null ì²´í¬ ì¶”ê°€
      if (currentUser !== authorUserId) {
        alert('ê²Œì‹œê¸€ ì‘ì„±ìë§Œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'); // ìˆ˜ì • ê¶Œí•œì´ ì—†ì„ ë•Œ ê²½ê³ ì°½ í‘œì‹œ
      } else {
        // ìˆ˜ì • í˜ì´ì§€ë¡œ ì´ë™
        window.location.href = e.target.getAttribute("href");
      }
    });

    document.querySelector('#delete').addEventListener('click', (e) => {
      e.preventDefault();
      if (confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        const num = e.target.dataset.num;
        console.log(num);
        if (num !== "null")
          location = `/board/delete/${num}`;
      }
    });

    function commentRm(id) {
      const isOk = confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
      if (isOk) {
        location = `/board/comment/remove?id=${id}&boardId=[[${board.id}]]`;
      }
    }

    function fileRm(id) {
      const isOk = confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
      if (isOk) {
        location = `/board/fileAtch/remove?id=${id}&boardId=[[${board.id}]]`;
      }
    }
  </script>
</body>

</html>